

yum install expat-devel
yum install gcc*


#####################
# PCRE 설치
#####################

1. 다운로드
mkdir -p /app/src
cd /app/src
wget http://sourceforge.net/projects/pcre/files/pcre/8.31/pcre-8.31.tar.gz
tar zxvf pcre-8.31.tar.gz
cd /app/src/pcre-8.31
./configure
make && make install

#####################
# APACHE 설치
#####################

### 소스파일 준비(httpd-2.4.33)
#apr과 apr-util은 apache src 하위 디렉토리로 옮긴다

1. apache 다운로드
mkdir -p /app/src
cd /app/src
wget http://apache.mirror.cdnetworks.com/httpd/httpd-2.4.34.tar.gz 
tar zxvf httpd-2.4.34.tar.gz

2. apr 다운로드
cd /app/src
wget http://apache.mirror.cdnetworks.com/apr/apr-1.6.3.tar.gz
tar zxvf apr-1.6.3.tar.gz
mv apr-1.6.3 /app/src/httpd-2.4.34/srclib/apr
ll /app/src/httpd-2.4.34/srclib/

3. apr-util 다운로드
cd /app/src
wget http://apache.mirror.cdnetworks.com/apr/apr-util-1.6.1.tar.gz 
tar zxvf apr-util-1.6.1.tar.gz
mv apr-util-1.6.1 /app/src/httpd-2.4.34/srclib/apr-util
ll /app/src/httpd-2.4.34/srclib/

4. apache 설치(OpenSSL manual update 후 설치)

cd /app/src/httpd-2.4.34

case. 표준설치 (OpenSSL 수동 업데이트 후 설치)
./configure --prefix=/app/apache24 --enable-modules=shared --enable-mods-shared=all --enable-pie --enable-ssl --with-ssl=/usr/local/ssl --enable-proxy --enable-proxy-balancer -enable-proxy-ajp -enable-proxy-http --enable-rewrite --enable-unique-id --enable-mpms-shared=all --with-included-apr

case. 통상적인 설치 옵션 및 절차
./configure --prefix=/app/apache24 --enable-proxy --enable-proxy-balancer --enable-proxy-ajp --enable-proxy-http --enable-rewrite --enable-ssl --enable-unique-id --enable-mods-shared=all --enable-modules=shared --enable-mpms-shared=all --with-included-apr

make && make install


#####################
# mod_jk 설치
#####################

###먼저, libtool 버전 일치 확인

#OS libtool 버전 확인
whereis libtool
/usr/bin/libtool --version

#Apache libtool  버전 확인
/app/apache24/build/libtool --version

#버전 정보 차이가 있으면 다음 과정으로 진행 Apache libtool 백업(apache libtool 위치로 이동 후)
cd /app/apache24/build/
mv libtool libtool_org
chmod 644 libtool_org
ln -s /usr/bin/libtool /app/apache24/build/libtool


### mod_jk 설치
cd /app/src
wget http://10.10.63.63:8089/downloads/apache/tomcat-connectors-1.2.43-src_r20180306.tar.gz
tar zxvf tomcat-connectors-1.2.43-src_r20180306.tar.gz
cd /app/src/tomcat-connectors-1.2.43-src/native
./configure --with-apxs=/app/apache24/bin/apxs

make && make install


chmod 755 /app/apache24/modules/mod_jk.so
ll /app/apache24/modules



#####################
# apache 설정
#####################

1. 설정파일 백업
cd /app/apache24/conf
bk httpd.conf

cd /app/apache24/conf/extra
bk httpd-mpm.conf
bk httpd-vhosts.conf
bk httpd-default.conf
bk httpd-ssl.conf

2. httpd.conf 설정

cat << EOF >> /app/apache24/conf/httpd.conf
### Global section
Include conf/extra/httpd-mpm.conf
Include conf/extra/httpd-vhosts.conf
Include conf/extra/httpd-default.conf
Include conf/extra/httpd-ssl.conf

### Main server configuration
ServerName localhost:80
ErrorLog "|/app/apache24/bin/rotatelogs logs/error.%y%m%d.log 86400 540"
CustomLog "|/app/apache24/bin/rotatelogs /logs/access.%y%m%d.log 86400 540" common
<Directory "/app/webapps">
    Options IncludesNoExec
    Order allow,deny
    Allow from all
    Require all granted
</Directory>
EOF

grep -v "#" /app/apache24/conf/httpd.conf

3. httpd-vhosts.conf 설정 (IP주소 수정)

cat << EOF > /app/apache24/conf/extra/httpd-vhosts.conf
<VirtualHost *:80>
    ServerAdmin webmaster@homeplus.co.kr
    DocumentRoot "/app/webapps"
    ServerName 10.10.64.90
    ServerAlias 10.10.64.90
    ErrorLog "|/app/apache24/bin/rotatelogs logs/error.%Y-%m-%d.log 86400 540"
    CustomLog "|/app/apache24/bin/rotatelogs logs/access.%Y-%m-%d.log 86400 540" combined
    LogLevel warn
</VirtualHost>
EOF

grep -v "#" /app/apache24/conf/extra/httpd-vhosts.conf

4. httpd-ssl.conf

/app/apache24/conf/extra/httpd-vhosts.conf







